<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>SneakerBeer</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link rel="apple-touch-icon" th:href="@{img/apple-icon.png}"/>
    <link rel="shortcut icon" type="image/x-icon" th:href="@{img/favicon.ico}"/>

    <link rel="stylesheet" th:href="@{/website/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/website/css/templatemo.css}"/>
    <link rel="stylesheet" th:href="@{/website/css/custom.css}"/>
    <!-- Google Web Fonts -->
    <link rel="preconnect" th:href="@{https://fonts.googleapis.com}"/>
    <link rel="preconnect" th:href="@{https://fonts.gstatic.com}" crossorigin/>
    <link
        th:href="@{https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Playfair+Display:wght@700;900&display=swap}"
        rel="stylesheet"
    />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">



    <!-- Icon Font Stylesheet -->
    <link
        th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css}"
        rel="stylesheet"
    />
    <link
        th:href="@{://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css}"
        rel="stylesheet"
    />

    <!-- Libraries Stylesheet -->
    <link th:href="@{/website/lib/animate/animate.min.css}" rel="stylesheet"/>
    <link th:href="@{/website/lib/owlcarousel/assets/owl.carousel.min.css}" rel="stylesheet"/>

    <!-- Customized Bootstrap Stylesheet -->
    <!-- <linkth:href="@{/website/css/bootstrap.min.css" rel="stylesheet" /> -->

    <!-- Template Stylesheet -->
    <link th:href="@{/website/css/style.css}" rel="stylesheet"/>

    <!-- Load fonts style after rendering the layout styles -->
    <link
        rel="stylesheet"
        th:href="@{https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;700;900&display=swap}"
    />
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <link rel="stylesheet" th:href="@{/website/css/fontawesome.min.css}"/>
    <link rel="stylesheet" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css}">
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Slick -->
    <link rel="stylesheet" type="text/css" th:href="@{/website/css/slick.min.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/website/css/slick-theme.css}"/>
    <!--

TemplateMo 559 Zay Shop

https://templatemo.com/tm-559-zay-shop

-->
    <style>
        .hidden {
            display: none;
        }

    </style>
    <!-- ... (Các khai báo khác như trong mã HTML trước) ... -->
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center">Giỏ hàng</h1>
    <div>
        <div th:if="${mess}" class="alert alert-success alert-dismissible fade show" role="alert" style="margin: 5px">
            <span th:text="${mess}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <form th:action="@{/user/add-order}" method="post">

            <!-- Nút thêm sản phẩm mới -->
            <div>
                <a th:href="@{/product/hien-thi}">
                    <button id="myButton" type="button" class="btn btn-success remove" title="thêm sản phẩm mới">
                        <i class="fas fa-plus-circle"></i>
                    </button>
                </a>
            </div>

            <!-- Form nhập địa chỉ mới -->
            <!-- Trong file giohang1.html hoặc trang thanh toán tương ứng -->
            <div class="form-group">
                <label for="selectedAddress">Địa Chỉ Nhận Hàng</label>
                <input type="text" class="form-control" id="selectedAddress" name="selectedAddress" readonly
                       th:value="${defaultAddress.streetName + ' ' + defaultAddress.district + ' ' + defaultAddress.province+ ' '+ (defaultAddress.defaultAddress ? 'Mặc Định':'')}"
                       th:if="${defaultAddress != null}" />

<!--                <span th:if="${defaultAddress != null and defaultAddress.defaultAddress}">(Mặc định)</span>-->
            </div>






            <button id="changeAddressBtn" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#changeAddressModal">
                Thay Đổi Địa Chỉ Nhận Hàng
            </button>

            <!-- Modal chọn địa chỉ -->
            <div class="modal fade" id="changeAddressModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Chọn Địa Chỉ Nhận Hàng</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Bảng chọn địa chỉ -->
                            <table>
                                <thead>
                                <tr>
                                    <th>Chọn</th>
                                    <th>Địa Chỉ</th>
                                    <!-- Thêm các cột thông tin khác nếu cần -->
                                </tr>
                                </thead>
                                <tbody>
                                <!-- Duyệt qua danh sách địa chỉ và hiển thị tương ứng -->
                                <tr th:each="address : ${addressList}">
                                    <td>
                                        <!-- Sử dụng radio button với biểu thức Thymeleaf -->
                                        <input type="radio" name="selectedAddressRadio"
                                               th:value="${address.id}"
                                               th:attr="data-streetName=${address.streetName}, data-district=${address.district}, data-province=${address.province}, data-defaultAddress=${address.defaultAddress }"
                                               onclick="updateSelectedAddress(this)">
                                    </td>
                                    <td>
                                        <span th:text="${address.streetName + ' ' + address.district + ' ' + address.province}"></span>
                                        <span th:if="${address.defaultAddress}">(Mặc định)</span>
                                    </td>
                                    <!-- Thêm các ô thông tin khác nếu cần -->
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="modal-footer">
                            <button id="addAddressBtn" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAddressModal">
                                Thêm Địa Chỉ Mới
                            </button>
                            <!-- Nút xác nhận thay đổi địa chỉ -->
                            <button id="confirmChangeBtn" type="button" class="btn btn-success" data-bs-dismiss="modal" >
                                Xác Nhận Thay Đổi
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Nút thêm địa chỉ mới -->



            <!-- Form để đặt làm địa chỉ mặc định -->
            <!-- Form để đặt làm địa chỉ mặc định -->



            <!-- Giỏ hàng -->
            <div class="card mt-4">
                <div class="card-body">
                    <!-- ... (Phần code hiện tại của bạn cho giỏ hàng) ... -->

                    <!-- Thông tin thanh toán -->
                    <h4 class="font-weight-semi-bold mt-4">Thông tin thanh toán</h4>

                    <!-- Chọn phương thức thanh toán -->
                    <div class="form-group">
                        <label for="paymentMethod">Phương thức thanh toán</label>
                        <select class="form-control" id="paymentMethod" name="paymentMethod">
                            <option value="creditCard">Thẻ tín dụng</option>
                            <option value="paypal">PayPal</option>
                            <!-- ... (Thêm các phương thức thanh toán khác) ... -->
                        </select>
                    </div>

                    <!-- Nhập mã giảm giá -->
                    <div class="form-group">
                        <label for="promoCode">Mã giảm giá</label>
                        <input type="text" class="form-control" id="promoCode" name="promoCode" placeholder="Nhập mã giảm giá">
                    </div>

                    <!-- Thông tin sản phẩm -->
                    <h4 class="font-weight-semi-bold mt-4">Thông tin sản phẩm</h4>

                    <table class="table">
                        <thead>
                        <tr>
                            <th scope="col">Hình ảnh</th>
                            <th scope="col">Tên sản phẩm</th>
                            <th scope="col">Số lượng</th>
                            <th scope="col">Đơn giá</th>
                            <th scope="col">Thành tiền</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="sl :${cart.getCartItems()}">
                            <td>
                                <img th:if="${sl.productDetails.productId.images != null and not #lists.isEmpty(sl.productDetails.productId.images)}"
                                     th:src="@{'/user/display?id=' + ${sl.productDetails.productId.id} + '&imageId=' + ${sl.productDetails.productId.images[0].id}}"
                                     alt="Sản phẩm" style="max-width: 50px; max-height: 50px" />
                            </td>
                            <td th:text="${sl.productDetails.productId.name}"></td>
                            <td th:text="${sl.quantity}"></td>
                            <td th:text="${sl.productDetails.sellPrice}"></td>
                            <td th:text="${sl.price * sl.quantity}"></td>
                        </tr>
                        </tbody>
                    </table>

                     Tổng số tiền
                    <div class="text-end">
                        Tổng số tiền: <span id="totalPrice" th:text="${cart.totalPrice} + 'Đ'" style="color: red;"></span>
                    </div>

                    <!-- Nút đặt hàng -->
                    <div class="d-grid gap-2 col-2 mx-auto mt-3">
                        <button id="placeOrderBtn" class="btn btn-primary" type="submit">Đặt Hàng</button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Form nhập địa chỉ mới -->
        <div class="modal fade" id="addAddressModal" tabindex="-1" role="dialog" aria-labelledby="addAddressModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addAddressModalLabel">Thêm Địa Chỉ Mới</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Form -->
                        <form th:action="@{/user/add1}" method="post" th:object="${newAddress}">
                            <input type="hidden" th:field="*{id}" />
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="streetName" class="form-label">Tên Đường</label>
                                    <input type="text" class="form-control" id="streetName" placeholder="Nhập Tên Đường" th:field="*{streetName}">
                                    <span th:if="${#fields.hasErrors('streetName')}" style="color: red; font-size: 13px" th:errors="*{streetName}"></span>
                                </div>

                                <div class="mb-3">
                                    <label for="district" class="form-label">Tên Huyện</label>
                                    <input type="text" class="form-control" id="district" placeholder="Nhập Tên Huyện" th:field="*{district}">
                                    <span th:if="${#fields.hasErrors('district')}" style="color: red; font-size: 13px" th:errors="*{district}"></span>
                                </div>

                                <div class="mb-3">
                                    <label for="province" class="form-label">Tên Tỉnh</label>
                                    <input type="text" class="form-control" id="province" placeholder="Nhập Tên Tỉnh" th:field="*{province}">
                                    <span th:if="${#fields.hasErrors('province')}" style="color: red; font-size: 13px" th:errors="*{province}"></span>
                                </div>

                                <div class="mb-3">
                                    <label for="zipcode" class="form-label">Số Điện Thoại</label>
                                    <input type="number" class="form-control" id="zipcode" placeholder="Nhập Số Điện Thoại" th:field="*{zipcode}">
                                    <span th:if="${#fields.hasErrors('zipcode')}" style="color: red; font-size: 13px" th:errors="*{zipcode}"></span>
                                </div>

                                <!-- Checkbox để chọn làm địa chỉ mặc định -->
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="setDefaultAddress" name="setDefaultAddress" th:field="*{defaultAddress}" />
                                    <label class="form-check-label" for="setDefaultAddress">Đặt làm Địa Chỉ Mặc Định</label>
                                </div>

                                <div class="mb-3">
                                    <button id="addAddressBtn1" class="btn btn-primary" type="submit" data-href='/user/checkout'>Thêm</button>

                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.min.js}"></script>


<!-- Liên kết với tệp JavaScript của Bootstrap (tuỳ chọn) -->
<script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js}"></script>
<!-- Liên kết với tệp bi-icons của Bootstrap (để sử dụng bi bi-trash) -->
<script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap-icons@1.20.0/font/bootstrap-icons.css}"></script>
<!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>-->

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<!-- Bootstrap Bundle with Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
    $(document).ready(function() {
        // Xử lý sự kiện khi chọn địa chỉ từ danh sách
        $('#selectedAddress').change(function() {
            var selectedAddressId = $(this).val();
            var defaultAddressCheckbox = $('#setDefaultAddress');

            // Kiểm tra nếu địa chỉ được chọn là mặc định
            if (selectedAddressId && selectedAddressId !== '') {
                // Ẩn checkbox chọn địa chỉ mặc định
                defaultAddressCheckbox.hide();
            } else {
                // Hiển thị checkbox chọn địa chỉ mặc định
                defaultAddressCheckbox.show();
            }
        });
    });
</script>
<script th:inline="javascript">
    $(document).ready(function () {
        $('#confirmChangeBtn').click(function () {
            var selectedAddressId = $('input[name="selectedAddressRadio"]:checked').val();
            var selectedRadio = $('input[name="selectedAddressRadio"]:checked');

            if (selectedRadio.length > 0) {
                // Lấy thông tin địa chỉ từ thuộc tính data-*
                var streetName = selectedRadio.attr('data-streetName');
                var district = selectedRadio.attr('data-district');
                var province = selectedRadio.attr('data-province');
                var isDefaultAddress = selectedRadio.attr('data-defaultAddress') === 'true';

                // Cập nhật giá trị của input text
                $('#selectedAddress').val(isDefaultAddress ? 'mặc định' : streetName + ' ' + district + ' ' + province);

                // Hiển thị hoặc ẩn mặc định tùy thuộc vào giá trị của isDefaultAddress
                if (isDefaultAddress) {
                    // Hiển thị mặc định
                    $('#defaultAddressMessage').show();
                } else {
                    // Ẩn mặc định
                    $('#defaultAddressMessage').hide();
                }

                // Đóng modal
                // ...

            } else {
                alert('Vui lòng chọn một địa chỉ.');
            }
        });
    });


</script>



<script>
    document.getElementById('changeAddressBtn').addEventListener('click', function() {
        // Ẩn thông tin địa chỉ hiện tại
        document.getElementById('currentAddressInfo').style.display = 'none';
        // Hiển thị bảng chọn địa chỉ
        document.getElementById('addressSelectionTable').style.display = 'block';
    });

    document.getElementById('confirmChangeBtn').addEventListener('click', function() {
        // Xử lý khi người dùng xác nhận thay đổi địa chỉ
        // (Có thể sử dụng JavaScript để lấy giá trị địa chỉ được chọn và thực hiện các hành động cần thiết)
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        var addAddressBtn = document.getElementById("addAddressBtn");
        var addAddressModal = new bootstrap.Modal(document.getElementById("addAddressModal"));

        addAddressBtn.addEventListener("click", function() {
            addAddressModal.show();
        });
    });
</script>
<script>
    function openAddAddressModal() {
        var myModal = new bootstrap.Modal(document.getElementById('addAddressModal'));
        myModal.show();
    }
</script>

<!-- JavaScript -->
<script th:inline="javascript">
    // Thêm mã JavaScript sau đây vào template của bạn
    $(document).ready(function () {
        $("#addAddressBtn1").click(function () {
            // Thực hiện AJAX để gửi dữ liệu địa chỉ mới lên server
            $.ajax({
                type: "POST",
                url: "/user/add1",
                data: $("#addAddressForm").serialize(),
                success: function (data) {
                    // Sau khi thêm thành công, chuyển hướng đến trang checkout
                    location.reload();
                    window.location.href = "/user/checkout";
                },
                error: function (error) {
                    console.log(error);
                }
            });
        });
    });
</script>
<script>
    function submitForm() {
        // Gửi yêu cầu khi người dùng chọn địa chỉ
        document.getElementById("setDefaultAddressForm").submit();
    }
</script>
<script>
    function submitForm() {
        // Lấy dữ liệu từ biểu mẫu
        var formData = $('#addAddressForm').serialize();

        // Gửi dữ liệu thông qua Ajax
        $.ajax({
            type: 'POST',
            url: '/user/add1',
            data: formData,
            success: function (response) {
                // Xử lý kết quả trả về từ controller
                if (response === 'success') {
                    // Đóng modal nếu thêm thành công
                    $('#addAddressModal').modal('hide');
                } else {
                    // Hiển thị lỗi nếu có
                    alert('Có lỗi xảy ra');
                }
            },
            error: function () {
                alert('Có lỗi xảy ra');
            }
        });
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Lấy nút "Thêm Địa Chỉ Mới"
        var addAddressBtn = document.getElementById('addAddressBtn');

        // Lấy nút "Đặt Hàng"
        var placeOrderBtn = document.getElementById('placeOrderBtn');

        // Thêm sự kiện click cho nút "Thêm Địa Chỉ Mới"
        addAddressBtn.addEventListener('click', function () {
            // Thực hiện các hành động tương ứng với việc nhấn nút "Thêm Địa Chỉ Mới"
            console.log('Click Thêm Địa Chỉ Mới');
        });

        // Thêm sự kiện click cho nút "Đặt Hàng"
        placeOrderBtn.addEventListener('click', function () {
            // Thực hiện các hành động tương ứng với việc nhấn nút "Đặt Hàng"
            console.log('Click Đặt Hàng');

            // Nếu bạn muốn submit form, bạn có thể sử dụng:
            // document.getElementById('yourFormId').submit();
        });
    });
</script>

</body>
</html>
